<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STP GitHub File Manager - Professional Repository Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .drag-over {
            border-color: #3b82f6 !important;
            background: rgba(59, 130, 246, 0.1) !important;
        }
        
        .file-item, .folder-item {
            animation: slideIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            transition: all 0.2s ease;
        }
        
        .file-item:hover, .folder-item:hover {
            transform: translateX(4px);
            background: rgba(99, 102, 241, 0.1);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .context-menu {
            animation: fadeIn 0.15s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .glass-effect {
            background: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .gradient-border {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2px;
            border-radius: 12px;
        }
        
        .gradient-border-content {
            background: #1f2937;
            border-radius: 10px;
        }
        
        .breadcrumb-item {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .breadcrumb-item:hover {
            color: #60a5fa;
        }
        
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .modal {
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .selected-file {
            background: rgba(59, 130, 246, 0.2) !important;
            border-color: #3b82f6 !important;
        }

        .toolbar-btn {
            transition: all 0.2s ease;
        }

        .toolbar-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .toolbar-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .preview-content {
            max-height: 500px;
            overflow-y: auto;
        }

        .preview-content::-webkit-scrollbar {
            width: 8px;
        }

        .preview-content::-webkit-scrollbar-track {
            background: #1f2937;
        }

        .preview-content::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }

        .preview-content::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 min-h-screen text-white">
    
    <!-- Header -->
    <header class="py-4 glass-effect sticky top-0 z-50 shadow-2xl">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center shadow-lg">
                        <i class="fab fa-github text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
                            STP GitHub File Manager
                        </h1>
                        <p class="text-xs text-gray-400">Created by Tarik Aziz</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="refreshBtn" class="toolbar-btn px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition flex items-center space-x-2">
                        <i class="fas fa-sync-alt"></i>
                        <span class="hidden sm:inline">Refresh</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-6 max-w-7xl">
        
        <!-- Main Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            
            <!-- Sidebar -->
            <div class="lg:col-span-1 space-y-4">
                <!-- Quick Actions -->
                <div class="gradient-border">
                    <div class="gradient-border-content p-4">
                        <h3 class="text-lg font-bold mb-4 flex items-center">
                            <i class="fas fa-bolt mr-2 text-yellow-400"></i>
                            Quick Actions
                        </h3>
                        <div class="space-y-2">
                            <button id="uploadFilesBtn" class="toolbar-btn w-full py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition flex items-center justify-center space-x-2">
                                <i class="fas fa-upload"></i>
                                <span>Upload Files</span>
                            </button>
                            <button id="createFolderBtn" class="toolbar-btn w-full py-3 bg-green-600 hover:bg-green-700 rounded-lg font-semibold transition flex items-center justify-center space-x-2">
                                <i class="fas fa-folder-plus"></i>
                                <span>New Folder</span>
                            </button>
                            <button id="deleteSelectedBtn" class="toolbar-btn w-full py-3 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition flex items-center justify-center space-x-2" disabled>
                                <i class="fas fa-trash"></i>
                                <span>Delete</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Storage Info -->
                <div class="gradient-border">
                    <div class="gradient-border-content p-4">
                        <h3 class="text-lg font-bold mb-4 flex items-center">
                            <i class="fas fa-database mr-2 text-blue-400"></i>
                            Repository Info
                        </h3>
                        <div class="space-y-3 text-sm">
                            <div>
                                <p class="text-gray-400 text-xs mb-1">Owner</p>
                                <p id="sidebarOwner" class="font-semibold text-blue-400">Not configured</p>
                            </div>
                            <div>
                                <p class="text-gray-400 text-xs mb-1">Repository</p>
                                <p id="sidebarRepo" class="font-semibold text-green-400">Not configured</p>
                            </div>
                            <div>
                                <p class="text-gray-400 text-xs mb-1">Branch</p>
                                <p id="sidebarBranch" class="font-semibold text-purple-400">Not configured</p>
                            </div>
                            <div>
                                <p class="text-gray-400 text-xs mb-1">Items Selected</p>
                                <p id="selectedCount" class="font-semibold text-yellow-400">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View Options -->
                <div class="gradient-border">
                    <div class="gradient-border-content p-4">
                        <h3 class="text-lg font-bold mb-4 flex items-center">
                            <i class="fas fa-eye mr-2 text-purple-400"></i>
                            View Options
                        </h3>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" id="showHiddenFiles" class="w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500">
                                <span class="text-sm">Show hidden files</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" id="compactView" class="w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500">
                                <span class="text-sm">Compact view</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="lg:col-span-3 space-y-4">
                
                <!-- Toolbar -->
                <div class="gradient-border">
                    <div class="gradient-border-content p-4">
                        <!-- Breadcrumb Navigation -->
                        <div class="flex items-center justify-between mb-4">
                            <div id="breadcrumb" class="flex items-center space-x-2 text-sm flex-wrap">
                                <i class="fas fa-home text-blue-400"></i>
                                <span class="breadcrumb-item text-blue-400 font-semibold" data-path="">Root</span>
                            </div>
                            <button id="viewToggleBtn" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition text-sm">
                                <i class="fas fa-th"></i>
                            </button>
                        </div>

                        <!-- Search and Sort -->
                        <div class="flex items-center space-x-3">
                            <div class="flex-1 relative">
                                <input type="text" id="searchInput" class="w-full px-4 py-2 pl-10 bg-gray-900 border-2 border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none" placeholder="Search files and folders...">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                            <select id="sortSelect" class="px-4 py-2 bg-gray-900 border-2 border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none">
                                <option value="name-asc">Name (A-Z)</option>
                                <option value="name-desc">Name (Z-A)</option>
                                <option value="size-asc">Size (Small first)</option>
                                <option value="size-desc">Size (Large first)</option>
                                <option value="date-asc">Date (Old first)</option>
                                <option value="date-desc">Date (New first)</option>
                                <option value="type">Type</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- File List -->
                <div class="gradient-border">
                    <div class="gradient-border-content p-4 min-h-[500px]">
                        <div id="loadingIndicator" class="flex flex-col items-center justify-center py-20">
                            <div class="loading-spinner mb-4"></div>
                            <p class="text-gray-400">Loading repository...</p>
                        </div>
                        
                        <div id="fileListContainer" class="hidden">
                            <div id="fileList" class="space-y-2"></div>
                            
                            <div id="emptyState" class="hidden flex flex-col items-center justify-center py-20">
                                <i class="fas fa-folder-open text-6xl text-gray-600 mb-4"></i>
                                <p class="text-xl text-gray-400 font-semibold">This folder is empty</p>
                                <p class="text-sm text-gray-500 mt-2">Upload files or create a new folder to get started</p>
                            </div>
                        </div>

                        <div id="errorState" class="hidden flex flex-col items-center justify-center py-20">
                            <i class="fas fa-exclamation-triangle text-6xl text-red-400 mb-4"></i>
                            <p class="text-xl text-red-400 font-semibold">Failed to load repository</p>
                            <p class="text-sm text-gray-400 mt-2 mb-4">Please check your configuration and try again</p>
                            <button id="retryBtn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition">
                                Retry
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="hidden fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4">
        <div class="modal bg-gray-800 rounded-2xl max-w-3xl w-full border border-gray-700 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 p-6 rounded-t-2xl flex items-center justify-between sticky top-0">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-cloud-upload-alt text-3xl"></i>
                    <h2 class="text-2xl font-bold">Upload Files</h2>
                </div>
                <button id="closeUploadBtn" class="text-white hover:text-gray-200 transition">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div class="p-6">
                <div id="dropZone" class="border-3 border-dashed border-gray-600 rounded-2xl p-12 text-center cursor-pointer hover:border-blue-500 hover:bg-gray-700 transition-all bg-gray-900 mb-6">
                    <div class="space-y-4">
                        <div class="flex justify-center">
                            <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                                <i class="fas fa-cloud-upload-alt text-3xl"></i>
                            </div>
                        </div>
                        <div>
                            <p class="text-xl font-semibold mb-2">Drag & Drop Files Here</p>
                            <p class="text-gray-400 mb-4">or</p>
                            <label for="fileUploadInput" class="inline-block px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 rounded-lg cursor-pointer transition font-semibold">
                                <i class="fas fa-folder-open mr-2"></i>
                                Browse Files
                            </label>
                            <input type="file" id="fileUploadInput" multiple class="hidden">
                        </div>
                    </div>
                </div>

                <div id="uploadFilesList" class="space-y-2 mb-4"></div>

                <div class="mb-4">
                    <label class="block text-sm font-semibold mb-2">Commit Message</label>
                    <textarea id="uploadCommitMsg" class="w-full px-4 py-3 bg-gray-900 border-2 border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none resize-none" rows="2" placeholder="Describe your changes...">Upload files via File Manager</textarea>
                </div>

                <button id="startUploadBtn" class="w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 rounded-lg font-bold transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    <i class="fas fa-rocket mr-2"></i>
                    Upload <span id="uploadFileCount">0</span> File(s)
                </button>
            </div>
        </div>
    </div>

    <!-- Create Folder Modal -->
    <div id="createFolderModal" class="hidden fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4">
        <div class="modal bg-gray-800 rounded-2xl max-w-md w-full border border-gray-700 shadow-2xl">
            <div class="bg-gradient-to-r from-green-600 to-emerald-600 p-6 rounded-t-2xl flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-folder-plus text-3xl"></i>
                    <h2 class="text-2xl font-bold">Create Folder</h2>
                </div>
                <button id="closeFolderBtn" class="text-white hover:text-gray-200 transition">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-semibold mb-2">Folder Name</label>
                    <input type="text" id="folderNameInput" class="w-full px-4 py-3 bg-gray-900 border-2 border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none" placeholder="my-folder">
                    <p class="text-xs text-gray-400 mt-1">Folder will be created in the current directory</p>
                </div>
                <button id="confirmCreateFolderBtn" class="w-full py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 rounded-lg font-bold transition">
                    <i class="fas fa-check mr-2"></i>
                    Create Folder
                </button>
            </div>
        </div>
    </div>

    <!-- File Preview Modal -->
    <div id="previewModal" class="hidden fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4">
        <div class="modal bg-gray-800 rounded-2xl max-w-5xl w-full border border-gray-700 shadow-2xl max-h-[90vh] overflow-hidden flex flex-col">
            <div class="bg-gradient-to-r from-purple-600 to-pink-600 p-6 rounded-t-2xl flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-file-alt text-3xl"></i>
                    <h2 id="previewFileName" class="text-2xl font-bold">File Preview</h2>
                </div>
                <div class="flex items-center space-x-3">
                    <a id="previewDownloadBtn" href="#" target="_blank" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition">
                        <i class="fas fa-download mr-2"></i>Download
                    </a>
                    <button id="closePreviewBtn" class="text-white hover:text-gray-200 transition">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
            </div>
            <div id="previewContent" class="p-6 overflow-y-auto flex-1 preview-content">
                <div class="flex items-center justify-center py-20">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div id="contextMenu" class="hidden fixed bg-gray-800 border border-gray-700 rounded-lg shadow-2xl py-2 z-50 min-w-[200px] context-menu">
        <button class="context-menu-item w-full px-4 py-2 hover:bg-gray-700 text-left flex items-center space-x-3 transition" data-action="preview">
            <i class="fas fa-eye text-blue-400 w-5"></i>
            <span>Preview</span>
        </button>
        <button class="context-menu-item w-full px-4 py-2 hover:bg-gray-700 text-left flex items-center space-x-3 transition" data-action="download">
            <i class="fas fa-download text-green-400 w-5"></i>
            <span>Download</span>
        </button>
        <button class="context-menu-item w-full px-4 py-2 hover:bg-gray-700 text-left flex items-center space-x-3 transition" data-action="rename">
            <i class="fas fa-edit text-yellow-400 w-5"></i>
            <span>Rename</span>
        </button>
        <div class="border-t border-gray-700 my-2"></div>
        <button class="context-menu-item w-full px-4 py-2 hover:bg-gray-700 text-left flex items-center space-x-3 transition" data-action="delete">
            <i class="fas fa-trash text-red-400 w-5"></i>
            <span>Delete</span>
        </button>
    </div>

    <script>
        // ============================================
        // üîß CONFIGURATION - Set your GitHub details here
        // ============================================
        const CONFIG = {
            GITHUB_TOKEN: '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',
            REPO_OWNER: 'shafimahmud2025',
            REPO_NAME: 'pos',
            BRANCH: 'main'
        };
        // ============================================

        // ============================================
        // Configuration & State Management
        // ============================================
        
        class GitHubFileManager {
            constructor() {
                this.config = this.loadConfig();
                this.currentPath = '';
                this.selectedItems = new Set();
                this.allFiles = [];
                this.contextMenuTarget = null;
                this.init();
            }

            loadConfig() {
                return {
                    token: CONFIG.GITHUB_TOKEN,
                    owner: CONFIG.REPO_OWNER,
                    repo: CONFIG.REPO_NAME,
                    branch: CONFIG.BRANCH
                };
            }

            isConfigured() {
                return this.config.token && this.config.owner && this.config.repo && this.config.branch;
            }

            async init() {
                this.setupEventListeners();
                this.updateUI();
                
                if (this.isConfigured()) {
                    await this.loadDirectory();
                } else {
                    this.showError();
                }
            }

            setupEventListeners() {
                // Upload modal
                document.getElementById('uploadFilesBtn').addEventListener('click', () => this.showUploadModal());
                document.getElementById('closeUploadBtn').addEventListener('click', () => this.hideUploadModal());
                
                const dropZone = document.getElementById('dropZone');
                const fileInput = document.getElementById('fileUploadInput');
                
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                    });
                });

                ['dragenter', 'dragover'].forEach(eventName => {
                    dropZone.addEventListener(eventName, () => dropZone.classList.add('drag-over'));
                });

                ['dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, () => dropZone.classList.remove('drag-over'));
                });

                dropZone.addEventListener('drop', (e) => this.handleFileDrop(e));
                dropZone.addEventListener('click', () => fileInput.click());
                fileInput.addEventListener('change', (e) => this.handleFileSelect(e));

                document.getElementById('startUploadBtn').addEventListener('click', () => this.uploadFiles());

                // Create folder modal
                document.getElementById('createFolderBtn').addEventListener('click', () => this.showCreateFolderModal());
                document.getElementById('closeFolderBtn').addEventListener('click', () => this.hideCreateFolderModal());
                document.getElementById('confirmCreateFolderBtn').addEventListener('click', () => this.createFolder());

                // Preview modal
                document.getElementById('closePreviewBtn').addEventListener('click', () => this.hidePreviewModal());

                // Other actions
                document.getElementById('refreshBtn').addEventListener('click', () => this.loadDirectory());
                document.getElementById('deleteSelectedBtn').addEventListener('click', () => this.deleteSelected());
                document.getElementById('retryBtn').addEventListener('click', () => this.loadDirectory());

                // Search and sort
                document.getElementById('searchInput').addEventListener('input', (e) => this.filterFiles(e.target.value));
                document.getElementById('sortSelect').addEventListener('change', () => this.renderFiles());

                // Context menu
                document.addEventListener('click', () => this.hideContextMenu());
                document.addEventListener('contextmenu', (e) => {
                    if (!e.target.closest('.file-item') && !e.target.closest('.folder-item')) {
                        this.hideContextMenu();
                    }
                });

                document.querySelectorAll('.context-menu-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const action = item.dataset.action;
                        this.handleContextMenuAction(action);
                    });
                });

                // View options
                document.getElementById('showHiddenFiles').addEventListener('change', () => this.renderFiles());
                document.getElementById('compactView').addEventListener('change', () => this.renderFiles());
            }

            // ============================================
            // UI Methods
            // ============================================

            updateUI() {
                // Update sidebar info
                document.getElementById('sidebarOwner').textContent = this.config.owner || 'Not configured';
                document.getElementById('sidebarRepo').textContent = this.config.repo || 'Not configured';
                document.getElementById('sidebarBranch').textContent = this.config.branch || 'Not configured';
                
                // Update selected count
                document.getElementById('selectedCount').textContent = this.selectedItems.size;
                
                // Enable/disable delete button
                document.getElementById('deleteSelectedBtn').disabled = this.selectedItems.size === 0;
            }

            showUploadModal() {
                if (!this.isConfigured()) {
                    alert('Configuration error! Please check your GitHub credentials in the code.');
                    return;
                }
                document.getElementById('uploadModal').classList.remove('hidden');
            }

            hideUploadModal() {
                document.getElementById('uploadModal').classList.add('hidden');
                document.getElementById('uploadFilesList').innerHTML = '';
                document.getElementById('fileUploadInput').value = '';
                this.uploadFiles = [];
            }

            showCreateFolderModal() {
                if (!this.isConfigured()) {
                    alert('Configuration error! Please check your GitHub credentials in the code.');
                    return;
                }
                document.getElementById('createFolderModal').classList.remove('hidden');
                document.getElementById('folderNameInput').value = '';
            }

            hideCreateFolderModal() {
                document.getElementById('createFolderModal').classList.add('hidden');
            }

            showPreviewModal(file) {
                document.getElementById('previewModal').classList.remove('hidden');
                document.getElementById('previewFileName').textContent = file.name;
                document.getElementById('previewDownloadBtn').href = file.download_url;
                this.loadFilePreview(file);
            }

            hidePreviewModal() {
                document.getElementById('previewModal').classList.add('hidden');
            }

            showContextMenu(e, item) {
                e.preventDefault();
                e.stopPropagation();
                
                this.contextMenuTarget = item;
                const menu = document.getElementById('contextMenu');
                
                menu.style.left = e.pageX + 'px';
                menu.style.top = e.pageY + 'px';
                menu.classList.remove('hidden');
                
                // Adjust if menu goes off screen
                setTimeout(() => {
                    const rect = menu.getBoundingClientRect();
                    if (rect.right > window.innerWidth) {
                        menu.style.left = (e.pageX - rect.width) + 'px';
                    }
                    if (rect.bottom > window.innerHeight) {
                        menu.style.top = (e.pageY - rect.height) + 'px';
                    }
                }, 0);
            }

            hideContextMenu() {
                document.getElementById('contextMenu').classList.add('hidden');
                this.contextMenuTarget = null;
            }

            // ============================================
            // GitHub API Methods
            // ============================================

            async apiRequest(endpoint, options = {}) {
                const url = `https://api.github.com/${endpoint}`;
                const headers = {
                    'Authorization': `token ${this.config.token}`,
                    'Accept': 'application/vnd.github.v3+json',
                    ...options.headers
                };

                const response = await fetch(url, { ...options, headers });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'API request failed');
                }

                return response.json();
            }

            async loadDirectory(path = '') {
                if (!this.isConfigured()) {
                    this.showError();
                    return;
                }

                this.currentPath = path;
                this.showLoading();

                try {
                    const endpoint = `repos/${this.config.owner}/${this.config.repo}/contents/${path}?ref=${this.config.branch}`;
                    const data = await this.apiRequest(endpoint);
                    
                    this.allFiles = Array.isArray(data) ? data : [data];
                    this.renderFiles();
                    this.updateBreadcrumb();
                    this.hideLoading();
                } catch (error) {
                    console.error('Error loading directory:', error);
                    this.showError();
                }
            }

            async loadFilePreview(file) {
                const previewContent = document.getElementById('previewContent');
                previewContent.innerHTML = '<div class="flex items-center justify-center py-20"><div class="loading-spinner"></div></div>';

                try {
                    if (file.type === 'file') {
                        const response = await fetch(file.download_url);
                        const content = await response.text();
                        
                        // Check file type
                        const ext = file.name.split('.').pop().toLowerCase();
                        const imageExts = ['jpg', 'jpeg', 'png', 'gif', 'svg', 'webp'];
                        const codeExts = ['js', 'ts', 'html', 'css', 'json', 'py', 'java', 'cpp', 'c', 'go', 'rs', 'php', 'rb'];
                        
                        if (imageExts.includes(ext)) {
                            previewContent.innerHTML = `<img src="${file.download_url}" class="max-w-full h-auto rounded-lg">`;
                        } else if (codeExts.includes(ext) || ext === 'txt' || ext === 'md') {
                            previewContent.innerHTML = `<pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto text-sm"><code>${this.escapeHtml(content)}</code></pre>`;
                        } else {
                            previewContent.innerHTML = `
                                <div class="text-center py-10">
                                    <i class="fas fa-file text-6xl text-gray-600 mb-4"></i>
                                    <p class="text-gray-400">Preview not available for this file type</p>
                                    <a href="${file.download_url}" target="_blank" class="inline-block mt-4 px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition">
                                        <i class="fas fa-download mr-2"></i>Download File
                                    </a>
                                </div>
                            `;
                        }
                    }
                } catch (error) {
                    previewContent.innerHTML = `
                        <div class="text-center py-10">
                            <i class="fas fa-exclamation-triangle text-6xl text-red-400 mb-4"></i>
                            <p class="text-red-400">Failed to load preview</p>
                            <p class="text-sm text-gray-400 mt-2">${error.message}</p>
                        </div>
                    `;
                }
            }

            async createFolder() {
                const folderName = document.getElementById('folderNameInput').value.trim();
                
                if (!folderName) {
                    alert('Please enter a folder name.');
                    return;
                }

                const path = this.currentPath ? `${this.currentPath}/${folderName}/.gitkeep` : `${folderName}/.gitkeep`;

                try {
                    await this.apiRequest(
                        `repos/${this.config.owner}/${this.config.repo}/contents/${path}`,
                        {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                message: `Create folder: ${folderName}`,
                                content: btoa(''),
                                branch: this.config.branch
                            })
                        }
                    );

                    this.hideCreateFolderModal();
                    await this.loadDirectory(this.currentPath);
                    alert('Folder created successfully!');
                } catch (error) {
                    alert('Failed to create folder: ' + error.message);
                }
            }

            async deleteFile(file) {
                if (!confirm(`Are you sure you want to delete "${file.name}"?`)) {
                    return;
                }

                try {
                    await this.apiRequest(
                        `repos/${this.config.owner}/${this.config.repo}/contents/${file.path}`,
                        {
                            method: 'DELETE',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                message: `Delete ${file.name}`,
                                sha: file.sha,
                                branch: this.config.branch
                            })
                        }
                    );

                    await this.loadDirectory(this.currentPath);
                    alert('File deleted successfully!');
                } catch (error) {
                    alert('Failed to delete file: ' + error.message);
                }
            }

            async deleteSelected() {
                if (this.selectedItems.size === 0) return;

                if (!confirm(`Are you sure you want to delete ${this.selectedItems.size} item(s)?`)) {
                    return;
                }

                const deletePromises = [];
                for (const path of this.selectedItems) {
                    const file = this.allFiles.find(f => f.path === path);
                    if (file) {
                        deletePromises.push(
                            this.apiRequest(
                                `repos/${this.config.owner}/${this.config.repo}/contents/${file.path}`,
                                {
                                    method: 'DELETE',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({
                                        message: `Delete ${file.name}`,
                                        sha: file.sha,
                                        branch: this.config.branch
                                    })
                                }
                            )
                        );
                    }
                }

                try {
                    await Promise.all(deletePromises);
                    this.selectedItems.clear();
                    await this.loadDirectory(this.currentPath);
                    alert('Items deleted successfully!');
                } catch (error) {
                    alert('Some items failed to delete: ' + error.message);
                    await this.loadDirectory(this.currentPath);
                }
            }

            // ============================================
            // File Upload Methods
            // ============================================

            handleFileDrop(e) {
                const files = Array.from(e.dataTransfer.files);
                this.displayUploadFiles(files);
            }

            handleFileSelect(e) {
                const files = Array.from(e.target.files);
                this.displayUploadFiles(files);
            }

            displayUploadFiles(files) {
                this.uploadFiles = files;
                const container = document.getElementById('uploadFilesList');
                container.innerHTML = '';

                files.forEach((file, index) => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center justify-between bg-gray-900 p-3 rounded-lg border-2 border-gray-700';
                    div.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <div class="text-2xl">${this.getFileIcon(file.name)}</div>
                            <div>
                                <p class="font-semibold text-sm">${file.name}</p>
                                <p class="text-xs text-gray-400">${this.formatFileSize(file.size)}</p>
                            </div>
                        </div>
                        <button onclick="manager.removeUploadFile(${index})" class="w-8 h-8 flex items-center justify-center bg-red-600 hover:bg-red-700 rounded transition">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    container.appendChild(div);
                });

                document.getElementById('uploadFileCount').textContent = files.length;
                document.getElementById('startUploadBtn').disabled = files.length === 0;
            }

            removeUploadFile(index) {
                this.uploadFiles.splice(index, 1);
                this.displayUploadFiles(this.uploadFiles);
            }

            async uploadFiles() {
                if (!this.uploadFiles || this.uploadFiles.length === 0) return;

                const commitMsg = document.getElementById('uploadCommitMsg').value.trim() || 'Upload files';
                const btn = document.getElementById('startUploadBtn');
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Uploading...';

                let successCount = 0;
                let failCount = 0;

                for (const file of this.uploadFiles) {
                    try {
                        const content = await this.readFileAsBase64(file);
                        const filePath = this.currentPath ? `${this.currentPath}/${file.name}` : file.name;

                        // Check if file exists
                        let sha = null;
                        try {
                            const existing = await this.apiRequest(`repos/${this.config.owner}/${this.config.repo}/contents/${filePath}?ref=${this.config.branch}`);
                            sha = existing.sha;
                        } catch (e) {
                            // File doesn't exist
                        }

                        await this.apiRequest(
                            `repos/${this.config.owner}/${this.config.repo}/contents/${filePath}`,
                            {
                                method: 'PUT',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    message: commitMsg,
                                    content: content,
                                    branch: this.config.branch,
                                    ...(sha && { sha })
                                })
                            }
                        );

                        successCount++;
                    } catch (error) {
                        console.error('Upload error:', error);
                        failCount++;
                    }
                }

                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-rocket mr-2"></i>Upload <span id="uploadFileCount">0</span> File(s)';

                alert(`Upload complete!\nSuccess: ${successCount}\nFailed: ${failCount}`);
                this.hideUploadModal();
                await this.loadDirectory(this.currentPath);
            }

            readFileAsBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result.split(',')[1]);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            }

            // ============================================
            // Rendering Methods
            // ============================================

            renderFiles() {
                const container = document.getElementById('fileList');
                const emptyState = document.getElementById('emptyState');
                const sortValue = document.getElementById('sortSelect').value;
                const showHidden = document.getElementById('showHiddenFiles').checked;
                const compactView = document.getElementById('compactView').checked;

                // Filter files
                let files = this.allFiles.filter(file => {
                    if (!showHidden && file.name.startsWith('.')) return false;
                    return true;
                });

                // Sort files
                files = this.sortFiles(files, sortValue);

                container.innerHTML = '';

                if (files.length === 0) {
                    emptyState.classList.remove('hidden');
                    return;
                }

                emptyState.classList.add('hidden');

                files.forEach(file => {
                    const div = document.createElement('div');
                    const isSelected = this.selectedItems.has(file.path);
                    
                    div.className = `${file.type === 'dir' ? 'folder-item' : 'file-item'} ${isSelected ? 'selected-file' : ''} flex items-center justify-between bg-gray-800 ${compactView ? 'p-2' : 'p-4'} rounded-lg border-2 border-gray-700 cursor-pointer`;
                    
                    div.innerHTML = `
                        <div class="flex items-center space-x-3 flex-1 min-w-0">
                            <div class="${compactView ? 'text-xl' : 'text-2xl'}">${file.type === 'dir' ? 'üìÅ' : this.getFileIcon(file.name)}</div>
                            <div class="flex-1 min-w-0">
                                <p class="font-semibold ${compactView ? 'text-sm' : ''} truncate">${file.name}</p>
                                ${!compactView && file.type === 'file' ? `<p class="text-xs text-gray-400">${this.formatFileSize(file.size)}</p>` : ''}
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            ${file.type === 'file' ? `
                                <button class="w-8 h-8 flex items-center justify-center bg-blue-600 hover:bg-blue-700 rounded transition" onclick="manager.showPreviewModal(${JSON.stringify(file).replace(/"/g, '&quot;')})">
                                    <i class="fas fa-eye text-sm"></i>
                                </button>
                            ` : ''}
                        </div>
                    `;

                    // Click to select/deselect
                    div.addEventListener('click', (e) => {
                        if (e.target.closest('button')) return;
                        
                        if (file.type === 'dir') {
                            this.loadDirectory(file.path);
                        } else {
                            if (this.selectedItems.has(file.path)) {
                                this.selectedItems.delete(file.path);
                            } else {
                                this.selectedItems.add(file.path);
                            }
                            this.renderFiles();
                            this.updateUI();
                        }
                    });

                    // Double click to open folder or preview file
                    div.addEventListener('dblclick', (e) => {
                        e.preventDefault();
                        if (file.type === 'dir') {
                            this.loadDirectory(file.path);
                        } else {
                            this.showPreviewModal(file);
                        }
                    });

                    // Context menu
                    div.addEventListener('contextmenu', (e) => this.showContextMenu(e, file));

                    container.appendChild(div);
                });
            }

            sortFiles(files, sortValue) {
                const [sortKey, order] = sortValue.split('-');
                
                return files.sort((a, b) => {
                    // Always show folders first
                    if (a.type !== b.type) {
                        return a.type === 'dir' ? -1 : 1;
                    }

                    let comparison = 0;

                    switch (sortKey) {
                        case 'name':
                            comparison = a.name.localeCompare(b.name);
                            break;
                        case 'size':
                            comparison = (a.size || 0) - (b.size || 0);
                            break;
                        case 'type':
                            const extA = a.name.split('.').pop() || '';
                            const extB = b.name.split('.').pop() || '';
                            comparison = extA.localeCompare(extB);
                            break;
                    }

                    return order === 'desc' ? -comparison : comparison;
                });
            }

            filterFiles(query) {
                // Implement search functionality
                // This would filter this.allFiles and re-render
                this.renderFiles();
            }

            updateBreadcrumb() {
                const breadcrumb = document.getElementById('breadcrumb');
                const parts = this.currentPath.split('/').filter(p => p);
                
                breadcrumb.innerHTML = '<i class="fas fa-home text-blue-400"></i>';
                
                const rootSpan = document.createElement('span');
                rootSpan.className = 'breadcrumb-item text-blue-400 font-semibold';
                rootSpan.dataset.path = '';
                rootSpan.textContent = 'Root';
                rootSpan.addEventListener('click', () => this.loadDirectory(''));
                breadcrumb.appendChild(rootSpan);

                let currentPath = '';
                parts.forEach((part, index) => {
                    currentPath += (currentPath ? '/' : '') + part;
                    
                    const separator = document.createElement('i');
                    separator.className = 'fas fa-chevron-right text-gray-600 text-xs';
                    breadcrumb.appendChild(separator);
                    
                    const span = document.createElement('span');
                    span.className = 'breadcrumb-item ' + (index === parts.length - 1 ? 'text-white font-semibold' : 'text-gray-400');
                    span.dataset.path = currentPath;
                    span.textContent = part;
                    
                    const pathToCopy = currentPath;
                    span.addEventListener('click', () => this.loadDirectory(pathToCopy));
                    
                    breadcrumb.appendChild(span);
                });
            }

            handleContextMenuAction(action) {
                if (!this.contextMenuTarget) return;

                switch (action) {
                    case 'preview':
                        if (this.contextMenuTarget.type === 'file') {
                            this.showPreviewModal(this.contextMenuTarget);
                        }
                        break;
                    case 'download':
                        if (this.contextMenuTarget.type === 'file') {
                            window.open(this.contextMenuTarget.download_url, '_blank');
                        }
                        break;
                    case 'delete':
                        this.deleteFile(this.contextMenuTarget);
                        break;
                    case 'rename':
                        alert('Rename functionality coming soon!');
                        break;
                }

                this.hideContextMenu();
            }

            // ============================================
            // Utility Methods
            // ============================================

            showLoading() {
                document.getElementById('loadingIndicator').classList.remove('hidden');
                document.getElementById('fileListContainer').classList.add('hidden');
                document.getElementById('errorState').classList.add('hidden');
            }

            hideLoading() {
                document.getElementById('loadingIndicator').classList.add('hidden');
                document.getElementById('fileListContainer').classList.remove('hidden');
            }

            showError() {
                document.getElementById('loadingIndicator').classList.add('hidden');
                document.getElementById('fileListContainer').classList.add('hidden');
                document.getElementById('errorState').classList.remove('hidden');
            }

            getFileIcon(filename) {
                const ext = filename.split('.').pop().toLowerCase();
                const icons = {
                    'jpg': 'üñºÔ∏è', 'jpeg': 'üñºÔ∏è', 'png': 'üñºÔ∏è', 'gif': 'üñºÔ∏è', 'svg': 'üé®', 'webp': 'üñºÔ∏è',
                    'pdf': 'üìÑ', 'doc': 'üìù', 'docx': 'üìù', 'txt': 'üìù', 'md': 'üìã',
                    'zip': 'üì¶', 'rar': 'üì¶', '7z': 'üì¶', 'tar': 'üì¶', 'gz': 'üì¶',
                    'mp3': 'üéµ', 'wav': 'üéµ', 'mp4': 'üé¨', 'avi': 'üé¨',
                    'js': 'üìú', 'ts': 'üìò', 'html': 'üåê', 'css': 'üé®', 'json': 'üìã',
                    'py': 'üêç', 'java': '‚òï', 'cpp': '‚öôÔ∏è', 'go': 'üîµ', 'rs': 'ü¶Ä'
                };
                return icons[ext] || 'üìÑ';
            }

            formatFileSize(bytes) {
                if (!bytes || bytes === 0) return '0 B';
                const k = 1024;
                const sizes = ['B', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        // Initialize the file manager
        const manager = new GitHubFileManager();
    </script>

    <!-- Footer -->
    <footer class="mt-12 pb-8 text-center text-gray-500">
        <p class="text-sm">
            Made with <i class="fas fa-heart text-red-500"></i> by <span class="text-blue-400 font-semibold">Tarik Aziz</span>
        </p>
        <p class="text-xs mt-2">
            <i class="fab fa-github mr-1"></i>
            STP GitHub File Manager ‚Ä¢ Secure ‚Ä¢ Professional
        </p>
    </footer>
</body>
</html>
